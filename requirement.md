# 深渡智慧农业平台 - 需求文档 (V2.1)

## 1. 项目概述

- **项目名称：** 深渡智慧农业平台
- **目标：** 开发一个纯前端、无后端的Web应用Demo，用于展示平台的核心功能和价值。
- **技术栈约束：** 任何前端框架（如Vue, React, Angular），使用静态JSON文件或在代码中定义的JS对象作为假数据源。无需任何后端API调用。
- **核心用户：** 地方政府农业部门的决策者、技术分析员及基层数据采集员。

## 2. 全局UI及通用功能

### 2.1 视觉风格
- **主题：** “数据可视化驾驶舱风格”。整体为深色主题，营造专业、沉浸的科技感。
- **主背景色：** 采用深邃的星空蓝或黑蓝背景（如 `#0a1929`），可带有不易察觉的网格或粒子动效背景。
- **面板容器：** 使用带有自定义边框和“辉光”效果的半透明面板（背景色如 `rgba(21, 38, 62, 0.6)`，边框色如 `rgba(0, 170, 255, 0.3)`）。
- **主色调：** 以高饱和度的“科技蓝” (`#00aaff`) 和“科技绿” (`#00ff7f`) 作为图表、高亮和关键数据的主色。
- **字体颜色：** 主要文本使用灰白色（如 `#c0c4cc`），标题和关键数字可使用主色调进行高亮。

### 2.2 顶部导航栏
- **左侧: Logo 与系统名称**
  - **Logo:** 显示项目Logo，尺寸约为 32x32px。
  - **系统名称:** "深渡智慧农业平台"，使用有科技感的字体，具有微弱的发光效果。点击Logo或名称可返回“综合态势大屏”首页。
- **中间: 一级导航菜单**
  - **样式:** 横向菜单，文字清晰。当前选中的菜单项需要高亮（如底部出现发光线条或文字变色）。
  - **菜单项:** `综合态势`、`数据资源`、`智能分析`、`农户管理`、`系统管理`。
- **右侧: 操作中心**
  - **通知中心:**
    - **图标:** 铃铛图标，使用 `el-badge` 在右上角显示未读消息数量（例如 `5`）。
    - **交互:** 点击图标，使用 `el-popover` 弹出一个宽度约300px的下拉面板。
    - **面板内容:** 滚动消息列表，每条消息包含 `类型图标`、`消息标题` 和 `时间`。例如：“[病害] 城关镇发生稻飞虱病害预警 - 5分钟前”。点击消息可导航至对应的分析页面。底部有“查看全部”链接。
  - **用户中心:**
    - **显示:** 用户头像和用户名（如“王分析员”）。
    - **交互:** 点击后，使用 `el-dropdown` 弹出下拉菜单。
    - **菜单项:** `个人中心`、`修改密码`、`系统设置`、`退出登录` (点击后模拟返回登录页)。


## 3. 模块化功能需求

---

### 3.1 综合态势大屏

> **[页面目标]** 进一步提升信息密度，为决策者提供一个信息全面、重点突出的全景指挥中心。

#### [核心组件与功能]

1.  **顶部核心指标卡片 (扩展):**
    - **描述:** 一行展示6个关键数字指标，突出显示，数字动态翻滚。
    - **具体指标:**
        - `耕地总面积`: 1,254,800 亩
        - `物联网设备总数`: 874 台
        - `设备在线率`: 98.5 %
        - `当月农事活动`: 128 次
        - `本月红色预警`: 4 次
        - `预计当季总产值`: ¥3.85 亿元

2.  **中间：全县农业GIS一张图 (增强):**
    - **描述:** 页面的核心，一个2.5D效果的GIS地图。地图上可有模拟的实时数据流光效，从在线设备点位发出，汇聚到数据中心。
    - **交互:** 点击地块弹出的信息框内容更丰富：`地块名称`, `作物类型`, `面积`, `地力指数`, `实时墒情`, `NDVI值`, `负责人`, `联系电话`，并提供一个“进入分析”的快捷按钮。

3.  **左侧面板区 (3个面板):**
    - **面板1 (上): 关键预警通知:** 无缝滚动列表，展示最新的5条预警，并按`红/橙/黄`等级用不同颜色图标区分。
    - **面板2 (中): 设备状态概览:** 一个ECharts环形饼图，标题为“设备在线状态”，展示 `在线` (如861台)、`离线` (如10台)、`告警` (如3台) 的数量和占比。
    - **面板3 (下): 农作物种植结构:** ECharts环形饼图，数据保持不变。

4.  **右侧面板区 (3个面板):**
    - **面板1 (上): 产量产值总览:** ECharts动态条形图，保持不变。
    - **面板2 (中): 地力健康指数:** 一个ECharts仪表盘图，标题为“全县平均地力指数”，指针指向一个综合评分（如 `85分`），并有优/良/中/差的刻度区域。
    - **面板3 (下): 预警数量趋势:** ECharts折线图，保持不变。

---

### 3.2 数据资源中心（重构）

> 目标：建立“数据源管理 + 采集监控 + 数据入湖 + AI赋能”的一体化中枢。明确可开发的列表字段、页面结构与交互，减少实现歧义。

子模块划分
- 3.2.A 实时采集中心（设备/平台）
- 3.2.B 知识库中心（非实时/资料类）
- 3.2.C 人工上报中心（移动端H5 + 后台审核）

#### 3.2.A 实时采集中心
1) 页面1：数据源总览（Dashboard）
   - 顶部指标：`设备总数`、`在线率`、`近24h上报量`、`告警数`、`覆盖乡镇数`。
   - 中部GIS：复用在线设备图层（类型图标、底部图例、无人机轨迹、点击打开设备面板）。
   - 右侧卡片：最近告警（设备/时间/级别/摘要，5条），待处理工单。

2) 页面2：设备台账（List + 侧滑详情）
   - 表格列（可排序/筛选/固定列）：
     - 基本：`设备ID`、`设备名称`、`类型`(soil/weather/field/moth/spore/drone/satellite)、`型号`、`厂商`、`所属乡镇`、`地块/坐标`、`安装时间`、`状态`(在线/离线/告警)、`电量(%)`、`最近上报时间`、`采样频率`、`覆盖半径/分辨率`、`固件版本`、`健康分`。
     - 运维：`维保到期`、`故障率(30d)`、`丢包率(24h)`、`累计在线时长`。
     - 操作列：`查看` `定位` `维保` `停用/启用`。
   - 侧滑详情（点击“查看”或行双击）：
     - 基本信息卡：与表格字段一致 + 二维码（设备ID）。
     - 实时数据卡：最近N条采样（以类型自适应字段；见“设备数据模型规范”）。
     - 图像/光谱卡：缩略图网格（点击放大）。
     - 地理卡：小地图定位（可飞行）。
     - 运维卡：维保记录、固件、报修、备注。

3) 页面3：单设备详情（Drilldown，可路由 `/data-center/device/:id`）
   - 顶部：设备名称/类型/状态/电量/最后上报/定位按钮。
   - 左列：实时数据时序图（最近24h/7d切换）；阈值告警气泡；采样间隔与丢包统计。
   - 右列：图片/光谱画廊、运维记录、健康评分构成（在线率、故障、丢包、超阈次数权重）。
   - 底部：同类型设备对比（箱线图/分位线），看该设备是否异常。

4) 页面4：采集监控（趋势 + 覆盖）
   - 维度选择：`类型`、`乡镇`、`时间范围`；
   - 卡片：上报趋势、异常/告警分布、覆盖热力（乡镇/地块聚合）、盲区建议（AI）。

5) 设备数据模型规范（最小集合）
   - 通用：`id, ts(ISO), lng, lat, sourceType, status, battery?`
   - soil(墒情)：`soilMoisture%, soilTemp°C, ph`。
   - weather(气象)：`temp°C, humidity%, windSpeed(m/s), rainfall(mm)`。
   - field(田间站)：`cropType, growthStage, healthIndex(0-100)`。
   - moth/spore：`count, riskLevel(low/medium/high)`、`trapType? / diseaseType?`。
   - drone(无人机)：`altitude(m), speed(m/s), coverage%` + `track[ts,lng,lat]`。

6) 地图与列表联动
   - 列表→地图：点击行→`flyTo`并高亮标记；
   - 地图→详情：点击标记→打开设备详情面板（复用综合态势组件）。

#### 3.2.B 知识库中心
1) 文档类别：`历史农情`、`气象与气候常态`、`政策法规`、`产业链与市场价格`、`作业指导/农事知识`。
2) 文档字段：`docId, title, category, tags[], version, source, author/uploader, publishAt, updatedAt, abstract, body(md/html), attachments[]`。
3) 能力：创建/编辑/版本管理/标签/全文检索；在分析页提供“相关知识”引用卡片（按标签与关键词召回）。

#### 3.2.C 人工上报中心
1) 移动端H5（示意）
   - 分步表单：
     1. 事件信息：`事件类型(病害/虫害/灾情/农事)`、`发生时间(默认当前)`、`所属乡镇`、`地块编号(可搜索)`；
     2. 现场信息：`描述(≥10字)`、`现场图片/视频(≤3)`、`定位(自动)`；
     3. 联系方式：`上报人`、`手机号`（校验）;
     4. 预览与提交。
   - 约束：离线缓存、弱网断点续传、图片大小压缩；
   - 成功页：展示记录号与进度（待审核/已采纳/退回）。
2) 后台审核 + 质检
   - 列表列：`记录ID`、`类型`、`乡镇/地块`、`上报人/电话`、`时间`、`AI评级`、`状态(待审/通过/退回)`、`质检得分`、`操作(查看/通过/退回)`。
   - 详情页：地图定位、媒体预览、AI判定要点、质检打分项（完整度/可用度）。
3) AI赋能（上报）
   - OCR/ASR：图片/语音转文本；
   - 事件归类：基于文本+图片多模分类（病害/虫害/灾情/农事）；
   - 质量校验：模糊/过曝/无关场景识别；
   - 风险等级建议：low/medium/high + 理由；
   - 自动补全：乡镇/地块匹配、时间可信度评分。

#### 3.2.D AI赋能（设备与区域）
- 设备级：
  - 故障预测：基于上报间隔波动、丢包、离线模式变化（输出T+7离线概率）。
  - 电量预测：基于温度/负载/历史，给出“T=0..7 天电量曲线”。
  - 越界/漂移检测：坐标漂移>阈值触发；无人机轨迹偏航率。
- 区域级：
  - 覆盖效率：按乡镇求“可达半径×在线率”的覆盖指数；
  - 盲区识别与新增点位建议（输出经纬度候选和理由）。

#### 3.2.E 权限与审计（简）
- 角色：运维、数据管理员、审核员、访客；
- 审计：设备操作（启停/固件）、数据导入、审核流转全量记录。

#### 3.2.F 非功能与统一规范
- 表格风格：按全局表格配色规范（默认1/2、悬停、选中）。
- 地图交互：与综合态势保持一致（遮罩、图例、时间轴可扩展）。
- 接口/文件：CSV/GeoJSON字段名遵循“设备数据模型规范”。

---

### 3.3 智能分析决策

> **[页面目标]** 对每个分析场景进行深度设计，明确输入、处理逻辑和输出结果，使其成为可独立演示和开发的完整功能。

#### 3.3.1 墒情监测与旱情分析
- **[页面目标]** 直观展示全县旱情分布，并能对任意地块进行深度历史数据追溯。
- **[筛选器]** `时间范围选择器` (快捷选项：近7天/近30天), `乡镇多选下拉框`。
- **[核心可视化布局]** 顶部为筛选器，中部是GIS地图，底部为数据图表区。
- **[具体组件描述]**
  - **GIS地图:** 地块根据土壤相对湿度分为5级渲染：`过湿(>85%)`-深蓝, `适宜(60-85%)`-绿色, `轻旱(40-60%)`-黄色, `中旱(20-40%)`-橙色, `重旱(<20%)`-红色。地图右下角必须有此图例说明。
  - **数据图表:** 默认显示全县各乡镇的平均土壤湿度柱状图。点击地图上任一地块后，此区域切换为该地块的“近30天土壤湿度变化”折线图，并标注出最高/最低值。

#### 3.3.2 作物长势遥感监测
- **[页面目标]** 通过遥感NDVI数据评估作物长势，并提供地块间的横向对比分析能力。
- **[筛选器]** `时间点选择器` (展示不同日期的遥感影像数据), `乡镇`, `作物类型`。
- **[核心可视化布局]** 页面分为左右两栏。左侧为GIS地图，右侧为数据分析区。
- **[具体组件描述]**
  - **GIS地图:** 地块根据NDVI值分为4级渲染：`优(>0.8)`-深绿, `良(0.6-0.8)`-绿色, `中(0.4-0.6)`-黄绿, `差(<0.4)`-黄色。用户可以点击地图上的“对比”按钮，然后选择最多4个地块。
  - **数据分析区:** 标题为“长势对比分析”。每当在地图上选择一个地块，就在此区域动态添加一个卡片。卡片内包含地块名称和一个mini折线图，展示该地块近3个季度的NDVI均值变化。

#### 3.3.3 土地用途分析
- **[页面目标]** 清晰地可视化全县土地资源的利用现状，并支持历史追溯，为国土规划和耕地保护提供数据依据。
- **[筛选器]** `年份选择器` (如 2025, 2020, 2015), `乡镇`。
- **[核心可视化布局]** 页面分为左右两栏，左侧为GIS地图，右侧为统计图表。
- **[具体组件描述]**
  - **GIS地图:** 根据地块的 `use_type` 属性进行颜色渲染。图例需明确：`耕地`-绿色, `林地`-深绿, `草地`-浅绿, `建设用地`-灰色, `水域`-蓝色。
  - **右侧统计面板:**
    - **面板1: 土地利用结构:** 一个ECharts玫瑰图，展示当前筛选条件下，各类土地用途的面积占比。
    - **面板2: 耕地变化趋势:** 一个ECharts分组柱状图，标题为“耕地面积变化”，X轴为乡镇名称，Y轴为面积（亩），对比展示当前年份与所选对比年份（如2015年）的耕地面积。

#### 3.3.4 耕地退化分析
- **[页面目标]** 识别存在退化风险的耕地，分析退化成因，为土壤改良和可持续耕作提供精准指导。
- **[筛选器]** `分析模型下拉框` (选项: 土壤酸化, 养分流失, 土壤盐碱化), `年份`。
- **[核心可视化布局]** 以GIS地图为核心，辅以数据面板进行量化说明。
- **[具体组件描述]**
  - **GIS地图:** 根据后台计算出的“退化指数”（0-1范围），将耕地地块渲染为不同风险等级的颜色：`高风险(指数>0.7)`-红色, `中风险(0.4-0.7)`-橙色, `低风险(<0.4)`-黄色。
  - **右侧数据面板:**
    - **风险等级统计:** 3个指标卡片，分别显示高、中、低风险的耕地面积及占比。
    - **退化趋势图:** 一个折线图，展示全县近10年的平均“退化指数”变化趋势。
    - **高风险地块列表:** 一个可滚动的列表，展示风险最高的10个地块的ID、所属乡镇和退化指数得分，点击可定位到地图上的对应位置。

#### 3.3.5 病虫害分析与预测
- **[页面目标]** 实时监控病虫害动态，预测扩散趋势，实现从被动响应到主动预警的转变。
- **[筛选器]** `时间范围`, `病虫害类型` (下拉多选: 稻飞虱, 玉米螟, 纹枯病等), `预警等级`。
- **[核心可视化布局]** 动态、时空一体化布局。中间为GIS地图，底部为时间轴，右侧为信息面板。
- **[具体组件描述]**
  - **GIS地图:** 地图上叠加两种图层：1. 已上报的病虫害“事件点”，用不同图标表示。 2. 基于算法预测的“风险圈”，为半透明的渐变色区域，表示未来24/48小时可能的扩散范围。
  - **时间轴:** 一个可拖动的滑块，范围是筛选器选定的时间。拖动滑块，地图上的“事件点”和“风险圈”会随时间动态变化，形成一个时空演变动画。
  - **右侧信息面板:**
    - **当前态势:** 统计`当前主要病害`, `累计影响面积`, `已发布预警数`。
    - **病害发生频率:** 一个条形图，统计所选时间内，不同病虫害的发生次数，进行排序。

#### 3.3.6 产量与产值预测
- **[页面目标]** 整合多源数据，提供对未来产量的科学预测，为农业生产和市场规划提供决策支持。
- **[筛选器]** `年份`, `季度`, `作物类型`。
- **[核心可视化布局]** 类仪表盘布局，顶部为核心预测总览，下方为多维度图表。
- **[具体组件描述]**
  - **核心预测卡片:** 4个大数字卡片，展示 `预估总产量(吨)`, `同比增减(%)`, `预估总产值(万元)`, `环比增减(%)`。
  - **产量分布柱状图:** 按乡镇展示各乡镇的预估产量，并可与去年同期数据进行对比。
  - **预测修正历史:** 一个折线图，展示自播种以来，模型对最终产量的预测值的变化过程，体现模型的动态调整能力。
  - **详细数据表格:** 列出各乡镇的 `种植面积`, `预估亩产(公斤)`, `市场均价(元/公斤)` 等详细数据。

#### 3.3.7 智慧灌溉数字孪生
- **[页面目标]** 以高保真三维场景，全过程模拟和展示一个高标准农田的自动化、智能化灌溉作业，是平台技术实力的终极体现。
- **[筛选器]** 页面加载一个预设的“高标准农田示范区”，无全局筛选器。
- **[核心可视化布局]** 全屏沉浸式3D场景，数据和控制面板以HUD（平视显示器）风格叠加在场景上。
- **[具体组件描述]**
  - **3D场景:** 使用Three.js或类似库构建。包含：地块的微地形、成排的作物三维模型、土壤传感器模型、气象站模型、以及可见的喷灌或滴灌管道和阀门。
  - **HUD面板1: 环境与土壤监测 (左上角)**
    - **环境:** `空气温度`, `空气湿度`, `风速`, `光照强度` 的实时仪表盘。
    - **土壤:** 以网格形式展示该地块内9个分区的土壤湿度实时读数，直观体现土壤墒情的不均匀性。
  - **HUD面板2: 灌溉控制与策略 (右侧)**
    - **模式选择:** `智能决策模式`(算法自动执行), `定时定量模式`, `手动控制模式`。
    - **策略选择 (智能模式下):** `节水优先策略`, `增产优先策略`。
    - **手动控制:** 开关组，可手动控制9个分区的阀门。
    - **执行按钮:** `启动灌溉任务`。
  - **HUD面板3: 成本与能耗分析 (左下角)**
    - 实时累计 `本次用水量(吨)`, `预估水费(元)`, `预估电费(元)`。
  - **动画效果:** 启动灌溉后，3D场景中对应的喷头或管道出现逼真的水流粒子特效，同时HUD面板上的土壤湿度读数和成本数据同步动态增长。

---

### 3.4 农户管理

> **[页面目标]** 建立一个集中的农业主体资源管理中心，对农户档案、关联土地、自有农机和农资使用进行全生命周期管理。

#### 3.4.1 主页面：农户列表
- **布局:** 占据整个页面的数据面板。
- **功能区:**
  - **搜索框:** 支持按 `姓名` 或 `联系电话` 模糊搜索。
  - **筛选器:** 按 `所属乡镇` 进行下拉筛选。
  - **操作按钮:** "新增农户" 按钮，样式醒目。
- **表格字段:** `农户ID`, `姓名`, `联系电话`, `所属乡镇`, `地块数量`, `农机数量`, `最后更新时间`, `操作`(`查看详情`, `编辑`, `删除`)。

#### 3.4.2 新增/编辑农户
- **交互:** 点击 "新增农户" 或 "编辑" 按钮，弹出一个 `el-dialog` 模态框。
- **表单字段:** `姓名`, `联系电话`, `身份证号`, `所属乡镇`(下拉), `家庭住址`, `备注`(文本域)。

#### 3.4.3 农户详情页 (`/farmer-management/:id`)
- **页面目标:** 360度全景展示与该农户相关的所有农业资源。
- **布局:** 顶部为该农户的“名片”（姓名、电话、乡镇），下方为一个 `el-tabs` 标签页组件。
- **标签页 (Tabs):**
  - **Tab 1: 关联地块:**
    - **功能:** 一个数据表格，显示该农户拥有的所有地块。
    - **表格字段:** `地块ID`, `地块名称`, `作物`, `面积(亩)`, `地力指数`。
    - **操作:** 提供“关联新地块”按钮，可打开一个包含全县未分配地块列表的模态框供选择。
  - **Tab 2: 农机管理:**
    - **功能:** 管理该农户拥有的所有农业机械。
    - **表格字段:** `农机ID`, `类型`(拖拉机/收割机/无人机), `品牌型号`, `购买日期`, `状态`(正常/维修中/报废)。
    - **操作:** “新增农机”按钮，可在弹窗中录入农机信息。
  - **Tab 3: 农资使用记录:**
    - **功能:** 记录农资（化肥、农药、种子）的购买和使用历史。
    - **表格字段:** `记录ID`, `年份`, `季节`, `农资类型`, `品牌`, `用量`, `购买日期`, `经办人`。
    - **操作:** “新增记录”按钮。

---

### 3.5 系统管理
> **[页面目标]** 展示平台具备完整的后台管理能力，增加专业性和完整度。

- **用户管理:** 一个包含`用户名`, `真实姓名`, `所属部门`, `角色`, `状态`, `创建时间`等字段的标准表格，带有增删改查按钮。
- **角色权限设置:** 左侧为角色列表（管理员、分析员、访客），右侧为该角色对应的功能权限树（element-ui的tree控件样式），带复选框。