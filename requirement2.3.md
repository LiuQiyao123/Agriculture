# 深渡智慧农业平台 - 需求文档 (V2.1) - 重构版

## 1. 项目概述

- **项目名称：** 深渡智慧农业平台
- **目标：** 开发一个纯前端、无后端的Web应用Demo，用于展示平台的核心功能和价值。
- **技术栈约束：** 任何前端框架（如Vue, React, Angular），使用静态JSON文件或在代码中定义的JS对象作为假数据源。无需任何后端API调用。
- **核心用户：** 地方政府农业部门的决策者、技术分析员及基层数据采集员。

## 2. 全局UI及通用功能

### 2.1 视觉风格
- **主题：** "数据可视化驾驶舱风格"。整体为深色主题，营造专业、沉浸的科技感。
- **主背景色：** 采用深邃的星空蓝或黑蓝背景（如 `#0a1929`），可带有不易察觉的网格或粒子动效背景。
- **面板容器：** 使用带有自定义边框和"辉光"效果的半透明面板（背景色如 `rgba(21, 38, 62, 0.6)`，边框色如 `rgba(0, 170, 255, 0.3)`）。
- **主色调：** 以高饱和度的"科技蓝" (`#00aaff`) 和"科技绿" (`#00ff7f`) 作为图表、高亮和关键数据的主色。
- **字体颜色：** 主要文本使用灰白色（如 `#c0c4cc`），标题和关键数字可使用主色调进行高亮。

#### 2.4 表格主题（全局统一）
- 适用范围：全站所有 Element Plus 表格（含列表、弹窗内表格）。
- 行背景与交互色（深色主题）：
  - 默认色1：`#0B192B`
  - 默认色2（斑马纹）：`#122236`
  - 悬停（经过）色：`#15273D`
  - 当前行/点击色：`#1B375C`
- 表头透明背景、文案颜色沿用主主题；不额外加阴影。

#### 2.5 信息展示容器/弹窗复用规范（供地图与分析模块共用）
- 触发对象：地图地块（Polygon）、在线设备（Marker）、其他模块内条目点击。
- 展示载体与位置：
  - 轻量信息：地图原生 `Popup`（位于遮罩之上，支持自定义类名与主题）。
  - 丰富信息：左列分析面板右侧的固定“设备/对象详情面板”（固定宽度≈320px，支持滚动、图片预览与数据网格）。
- 基础结构：标题区（名称+类型/状态）/ 实时数据网格 / 图片与光谱预览 / 位置信息 / 时间戳。
- 统一字段命名建议：`id, name, type, status, coordinates, battery?, lastSeen?, town?, data?, images?`。
- 交互：
  - 点击地图标记/地块：打开相应的信息载体；再次点击空白处或关闭按钮收起。
  - 复用接口：各模块仅传入对象数据，遵循上述字段约定即可复用展示组件。

#### 2.6 响应式与缩放一致性（通用）
- 视口：`<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover">`。
- 布局约束：
  - 列与面板项在 Flex 布局中统一增加 `min-width:0; min-height:0;`，防止内容把列撑爆。
  - 内容区内边距采用响应式：`padding: clamp(8px, 1vw, 15px)`；正文文本字号可用 `clamp(12px, 1.1vw, 14px)`。
- 指标卡片（顶部）：
  - 数值字号略缩小（参考 24px），标题/副文案 12px，三行间距更紧凑且一致。

### 2.2 顶部导航栏
- **左侧: Logo 与系统名称**
  - **Logo:** 显示项目Logo，尺寸约为 32x32px。
  - **系统名称:** "深渡智慧农业平台"，使用有科技感的字体，具有微弱的发光效果。点击Logo或名称可返回"综合态势大屏"首页。
- **中间: 一级导航菜单**
  - **样式:** 横向菜单，文字清晰。当前选中的菜单项需要高亮（如底部出现发光线条或文字变色）。
  - **菜单项:** `综合态势`、`数据资源`、`智能分析`、`农户管理`、`系统管理`。
- **右侧: 操作中心**
  - **通知中心:**
    - **图标:** 铃铛图标，使用 `el-badge` 在右上角显示未读消息数量（例如 `5`）。
    - **交互:** 点击图标，使用 `el-popover` 弹出一个宽度约300px的下拉面板。
    - **面板内容:** 滚动消息列表，每条消息包含 `类型图标`、`消息标题` 和 `时间`。例如："[病害] 城关镇发生稻飞虱病害预警 - 5分钟前"。点击消息可导航至对应的分析页面。底部有"查看全部"链接。
  - **用户中心:**
    - **显示:** 用户头像和用户名（如"王分析员"）。
    - **交互:** 点击后，使用 `el-dropdown` 弹出下拉菜单。
    - **菜单项:** `个人中心`、`修改密码`、`系统设置`、`退出登录` (点击后模拟返回登录页)。

### 2.3 下拉二级菜单
- **触发:** 当点击一级导航中含有子模块的菜单项时（如"智能分析"），页面左侧滑出或固定显示二级菜单下拉栏。
- **功能:** 列出所属一级模块下的所有子功能页面链接，如"墒情监测与旱情分析"、"作物长势遥感监测"等。当前所在的子页面链接高亮。

## 3. 模块化功能需求

---

### 3.1 综合态势大屏 (深度重构版)

> **[页面目标]** 摒弃抽象评分，通过具体、可量化的核心指标与多维分析预测面板，为管理者提供一个能洞察全局、诊断细节、预见未来的实战型指挥中心。

#### 1. 顶部核心指标卡片区

**设计原则：** 每一个指标都应是一个由AI模型驱动的、具有业务判断价值的核心结果，而非简单的统计。采用**趋势比较版**，每个指标均附带动态的趋势变化说明。

**【指标卡片备选库 (建议选择4-8个)】**

| 指标名称 | 数据构成与解读 | 示例值 |
|---------|---------------|--------|
| **1. 主粮产量预测**(核心预测) | 融合长势、未来气象和历史数据，动态预测全县当季主粮作物的**最终产量**。 | **15.8 万吨** <span style="color:lime">▲ 2.1% (较上周预测)</span> |
| **2. 重大病虫害影响面积**(风险预警) | 当前发生的最严重病害的预估影响面积，选择影响面积最大的单一病害进行展示。 | **1.5 万亩** <span style="color:red">稻飞虱影响</span> |
| **3. 灾害预警地块数**(风险预警) | 预测未来7日内可能达到轻度气象灾害以上等级的地块数量。 | **235 个地块** <span style="color:red">旱情预警</span> |
| **4. 农机作业饱和度**(生产要素) | 统计大型农机（已接入平台）的实时作业率，反映农业生产的**繁忙程度与资源利用率**。 | **85%** <span style="color:gray">(120/142台作业中)</span> |
| **5. 设备在线率**(数字化基础) | 全县农业物联网设备的实时在线率，反映数字农业基础设施运行状态。 | **98.5%** <span style="color:lime">874台在线</span> |
| **6. 今日农事活动**(生产动态) | 当日全县上报的农事活动总数，反映农业生产活跃度。 | **128 次** <span style="color:lime">较昨日 +15</span> |
| **7. 本月红色预警**(风险统计) | 本月累计发布的红色等级预警次数，反映重大风险发生频率。 | **4 次** <span style="color:orange">较上月 -2</span> |
| **8. 当季总产值预估**(经济效益) | 基于产量预测和市场价格预测，估算全县当季农业总产值。 | **¥3.85 亿元** <span style="color:lime">▲ 8.2% (同比)</span> |

#### 2. 中央GIS一张图

**设计原则：** 融合**主题视图**、**多维图层**与**时空预测**能力，使其成为一个可交互的、多功能的时空数据分析器。

**核心功能1: 主题视图切换 (Theme Views)**
- **描述:** 地图左上角提供下拉菜单，一键切换地图的业务主题。
- **预设主题:** `农业生产视图`、`数字乡村治理视图`。

**核心功能2: 动态图层控制 (Layer Controls)**
- **描述:** 每个主题视图下，都提供独立的、可勾选的图层控制面板。
- **农业生产视图下:** 
  - `地块边界` (默认显示)与任何图层都不互斥。下面的所有图层都是互斥的。点击地块，展示地块的具体信息。具体信息的内容先以目前展示的内容为准。
  - `在线设备` (默认显示)显示不同类型设备的图标（我后续会设计图标并上传）。在地图下方、图层选择容器上方展示图例checkbox，包括图标+类别文本，包括类别如下：墒情传感器、气象监测站、田间监测站、虫情测报仪、孢子测报仪、巡飞无人机（支持显示实时位置，频率1HZ）。可以通过checkbox切换是否显示，默认全部显示。点击地图上的具体图标，展示其设备的对应数据和图像、光谱资料。
  - `作物长势(NDVI)`：点击该图层，展示每个地块的NDVI值对应的颜色。
  - `土壤墒情评估`：点击该图层，展示每个地块的基于含水量、相对湿度、容重、到税率、孔隙度等指标综合评分后对应的颜色。
  - `病虫害监测`：点击该图层，展示每个地块的病害密度、风险等一系列参数综合评分后对应的颜色。
  - `气象灾害预警`：点击该图层，展示每个地块综合评分后对应的颜色。
  - `灌溉系统`：点击该图层，将灌溉线路展示在地图上，用线表示即可。
  - `产量预测`：点击该图层，展示每个地块产量预测信息对应的颜色。
  - `土壤肥力`：点击该图层，展示每个地块肥力评估值对应的颜色。
  从作物长势到土壤肥力这些图层，都需要在点击图层时增加一个时间轴，以天为单位，默认显示当天，提供T-7的历史数据和T+7的预测数据。可以通过滑动时间轴的滑块来查看不同时间的颜色分布情况。
- **图层控制面板优化:**
  - 支持多行显示，自动换行
  - 按钮尺寸优化，支持更多选项
  - 最大宽度限制，避免遮挡地图
  - 响应式布局，适应不同屏幕尺寸
- **数字乡村治理视图:** 暂时不做。

**核心功能2.1: 图层清单与互斥规则（更新）**
- `地块边界`：默认开，与其它图层不互斥。
- 下列图层互斥（同一时刻仅一个可见）：`在线设备`、`作物长势(NDVI)`、`土壤墒情评估`、`病虫害监测`、`气象灾害预警`、`灌溉系统`、`产量预测`、`土壤肥力`。
- 说明：`在线设备` 与其它图层互斥，避免信息干扰（已实现）。

**核心功能2.2: 在线设备（更新）**
- 地图标记：使用“设备类型图标”而非纯色圆点；类型包括：`墒情传感器 soil`、`气象监测站 weather`、`田间监测站 field`、`虫情测报仪 moth`、`孢子测报仪 spore`、`巡飞无人机 drone`（无人机支持实时轨迹动画，频率≈1Hz）。
- 图例：位于地图底部、图层按钮上方，显示“图标+类型名称”的可切换项（checkbox 行为，默认全开，字体≥14px）。
- 点击交互：打开“设备详情面板”（固定在左列分析面板的右侧），展示名称、类型/状态、电量、最近上报、实时数据网格、图像/光谱预览、位置信息等。

**核心功能2.3: 灌溉系统（更新）**
- 数据：`GeoJSON LineString`，字段含 `id, name, type, capacity, status`。
- 样式：基于 `capacity` 使用 MapLibre `interpolate` 动态设置 `line-color` 与 `line-width`；叠加半透明阴影层（略偏移）以提升立体感；仅以“线”呈现，不改变地块填充颜色。

**核心功能2.4: 地图遮罩（新增）**
- 在地图容器上方叠加径向遮罩：
  - `background: radial-gradient(ellipse at 50% 50%, rgba(13,27,28,0) 0%, rgba(13,27,28,0.04) 40%, rgba(13,27,28,0.7) 61%, rgba(13,27,28,1) 100%)`；
  - 不阻塞交互（`pointer-events: none`）；层级低于控件/弹窗，高于底图。

**核心功能3: 时空回溯与预测 (Spatio-temporal & Predictive Control)（细化）**
- **描述:** 地图底部提供时间轴滑块，包含"过去"和"未来"两个区域。
- **交互:** 当用户选择时空敏感图层（如`土壤墒情`）后：
  - **拖动到过去:** 地图渲染每个地块历史某天的墒情评估分布快照。
  - **拖动到未来 (+7天):** 地图**动态渲染出AI模型预测的未来7日墒情发展趋势**，高风险区域以闪烁或高亮形式凸显，将"预测"能力可视化。

> 时间轴实现规范（已落地）
- 结构：居中浮层容器（与设备图例底对齐），包含标题、当前日期、轨道、滑块与日期刻度标记。
- 索引映射：滑块值与 `timeAxisData[T-7..T+7]` 下标一一对应，避免“滑块位置与日期不一致”。
- 文案与尺寸：标记最小宽度与字号可调；容器支持 `max-width: 98vw` 防止爆框。

**▼ 详细功能拆解**
1.  地图基底
    - 使用 MapTiler 卫星 + 中国中文标注自定义样式；默认视图中心定位到山东省济南，`zoom = 6.5`。
    - 支持鼠标拖拽、滚轮缩放、双击放大/Shift+双击缩小，保留旋转与倾斜手势。
    - 右下角显示版权 `© MapTiler | © OpenStreetMap`，字体 `10px`, 透明度 100%，默认收起容器。

2.  地块边界渲染：**默认展示地块边界**
    - 数据来源：`static/geojson/plots.json`，包含全县所有地块 Polygon，字段：`id`, `name`, `crop`, `areaMu`, `owner`, `phone`。
    - 默认填充透明，仅在鼠标悬停时高亮边框 `#00aaff`，宽 2 px。
    - 点击 Polygon 弹出“地块信息 Popup”，字段与样式见“2.5 信息展示容器/弹窗复用规范”。

3.  在线设备流光效果
    - 数据来源：`static/json/devices.json`，字段：`id`, `lng`, `lat`, `type`, `status`(online/offline/alarm)。
    - 渲染：每 5 s 执行一次粒子拉伸动画，从设备点扩散出一条 `#00aaff` 到地图中心的光带，持续 1 s 淡出。
    - 性能：点数 < 500 时逐点渲染；≥ 500 时启用 CanvasLayer 批量渲染。
    - 点击设备：打开“设备详情面板”，位置为左列分析面板的右侧（固定面板，支持滚动与图片预览）。

4.  地块信息弹窗
    - 触发：点击 Polygon。
    - 样式：深色半透明卡片，宽 280 px，带 `0 0 8px #00aaff` 外发光。
    - 内容字段：
        | 字段 | 说明 |
        |------|------|
        | 地块名称 | `name` |
        | 作物类型 | `crop` （枚举：水稻/小麦/玉米/蔬菜/其它）|
        | 面积 | `areaMu` (亩) |
        | 地力指数 | `soilScore`，进度条样式，优>90 良>70 中>50 差≤50 |
        | 预计产量 | 显示产量和预估的截止时间，蓝色文字高亮 |
        | 预计产值 | 显示产值和预估的截止时间，蓝色文字高亮 |
        | NDVI值 | `ndvi`，绿色文字高亮 |
        | 农户 | `owner` |
        | 联系电话 | `phone`，可点击 `tel:` |
    - 底部按钮：`进入分析`，点击后路由到 `/analysis/plot/:id`。

5.  图层控制面板
    - 位置：地图底部居中，`bottom:20px; left:50%; transform:translateX(-50%)`。
    - 样式：半透明深色圆角盒子，内边距 `10 px 20 px`，间距 `15 px`。不要用checkbox，要用类似按钮的样式
    - 选项：
        - `在线设备`（默认开）
        - `NDVI 热力图`（默认关，点击后加载 `static/tiles/ndvi/{z}/{x}/{y}.png` 瓦片图层，0.6 透明度）

6.  性能与容错
    - 地块 > 2000 时，简化为 Centroid 点 + 凸包悬浮提示，缩放至 `zoom ≥ 12` 再按 Polygon 渲染。
    - GeoJSON/JSON 均采用 gzip 压缩后按需懒加载，确保首屏地图初始化 < 800 ms。
    - 若设备数据拉取失败，显示 Toast "设备数据加载失败，将仅显示地块边界"。

#### 3. 左右两侧分析面板

**设计原则：** 严格遵循"**左侧全局、右侧聚焦**"的交互范式。左侧始终展示全域宏观分析，右侧在用户选择地块后，动态展示该地块的微观诊断报告。

**左侧全域分析面板 (全局视角)**

**【分析面板备选库 (建议选择2-3个组合)】**

**备选A: 关键风险预测与告警**
- **定位:** 替代原有的"关键预警通知"和"预警趋势"。
- **内容:**
  - **上半部分 - 实时告警列表:** 滚动展示已发生的、需要立即关注的TOP 5告警事件（设备告警、灾情上报等）。
  - **下半部分 - 未来风险看板:** AI每日生成，用雷达图展示未来一周内，`旱灾`、`涝灾`、`病害`、`虫害`、`风灾`等几类主要风险的**概率预测**，并附AI文字解读。

**备选B: 全域作物长势诊断**
- **定位:** 替代原有的"农作物种植结构"。
- **内容:**
  - **长势分级占比:** 柱状图展示全县作物长势评定为"优、良、中、差"的**耕地面积**。
  - **AI诊断报告 (文本):** 自动生成分析短文，如：`"当前全县85%作物长势良好。其中，南部区域因光照充足，长势普遍优于北部；白马乡有约200亩地块NDVI值连续两周下降，已发出长势异常预警，需重点关注。"`

**备选C: 主导产业供需预测**
- **定位:** 替代原有的"产量产值总览"。
- **内容:** 聚焦本县1-2个核心主导产业（如水稻）。
  - **供需预测曲线:** 一个双轴折线图，同时展示未来3个月内该品种的`预测产量曲线`和`预测市场需求曲线`。
  - **AI决策建议 (文本):** `"模型预测未来2个月内，水稻市场将呈现供过于求的态势。建议引导合作社、农户分批次销售，或拓展加工、仓储渠道，避免集中上市导致价格下跌。"`

**备选D: 农机资源调度热力图**
- **定位:** 运营管理型图表。
- **内容:** 一张小型行政区划地图，用热力图方式实时渲染大型农机（已接入平台）的**空间分布密度与闲置率**，颜色越深表示资源越集中或闲置率越高，辅助跨区调度。

**右侧聚焦分析面板 (地块/主体视角)**

**交互:** 默认状态下显示全辖区综合数据。用户点击任一地块后，此面板内容从"全辖区平均值"切换到"该地块专属分析报告"。

**面板标题:** 默认显示"辖区综合态势分析"，点击地块后显示"地块专属分析报告: [地块名称]"

**【面板内组件详细规范】**

**组件A: 辖区健康诊断概览**
- **定位:** 核心诊断模块，替代所有抽象"评分"，提供具体、可操作的诊断结果。
- **内容结构:**
  - **上半部分 - 实时大田图像:** 
    - 尺寸：宽280px，高180px，圆角8px，边框 `1px solid rgba(0, 170, 255, 0.3)`
    - 内容：显示当前选中地块的实时监控图像（如无选中地块，显示辖区代表性大田）
    - 图像来源：`static/images/field-monitor/{plotId}.jpg` 或默认 `static/images/field-monitor/default.jpg`
    - 覆盖层：右下角显示拍摄时间，格式 "2024-01-15 14:30"
    - 交互：点击图像可放大查看（使用 `el-image` 的 `preview-src-list`）
  
  - **下半部分 - 健康诊断清单:**
    - 采用医疗体检报告风格，每个指标包含：指标名称、当前值、标准范围、状态评级、具体分析、建议措施
    - **土壤有机质:**
      - 当前值：`{{ districtDiagnosis.organic }}`
      - 标准范围：2.0-3.5%
      - 状态评级：优(>2.8) 良(2.3-2.8) 中(2.0-2.3) 差(<2.0)
      - 具体分析：`{{ districtDiagnosis.organicAnalysis }}`
      - 建议措施：`{{ districtDiagnosis.organicSuggestion }}`
    
    - **土壤速效氮:**
      - 当前值：`{{ districtDiagnosis.nitrogen }} mg/kg`
      - 标准范围：80-120 mg/kg
      - 状态评级：优(>100) 良(90-100) 中(80-90) 差(<80)
      - 具体分析：`{{ districtDiagnosis.nitrogenAnalysis }}`
      - 建议措施：`{{ districtDiagnosis.nitrogenSuggestion }}`
    
    - **土壤湿度:**
      - 当前值：`{{ districtDiagnosis.moisture }}%`
      - 标准范围：60-80%
      - 状态评级：优(70-80) 良(65-70) 中(60-65) 差(<60或>80)
      - 具体分析：`{{ districtDiagnosis.moistureAnalysis }}`
      - 建议措施：`{{ districtDiagnosis.moistureSuggestion }}`
    
    - **作物苗齐度:**
      - 当前值：`{{ districtDiagnosis.uniformity }}%`
      - 标准范围：>90%
      - 状态评级：优(>95) 良(92-95) 中(90-92) 差(<90)
      - 具体分析：`{{ districtDiagnosis.uniformityAnalysis }}`
      - 建议措施：`{{ districtDiagnosis.uniformitySuggestion }}`
    
    - **NDVI指数:**
      - 当前值：`{{ districtDiagnosis.ndvi }}`
      - 标准范围：0.6-0.9
      - 状态评级：优(>0.8) 良(0.7-0.8) 中(0.6-0.7) 差(<0.6)
      - 具体分析：`{{ districtDiagnosis.ndviAnalysis }}`
      - 建议措施：`{{ districtDiagnosis.ndviSuggestion }}`

**组件B: 辖区风险与产量预测**
- **定位:** 提供针对性的未来预测和风险预警。
- **内容结构:**
  - **病害风险预测:**
    - 时间维度：未来7天、15天、30天
    - 风险等级：无风险(0-20%) 低风险(20-40%) 中风险(40-60%) 高风险(60-80%) 极高风险(80-100%)
    - 具体病害：稻瘟病、纹枯病、稻飞虱、玉米螟等
    - 显示格式：`{{ districtRisk.disease }}`
    - 分析依据：历史发病数据、气象条件、作物品种抗性
    - 防控建议：`{{ districtRisk.diseaseSuggestion }}`
  
  - **旱情风险预测:**
    - 时间维度：未来7天、15天、30天
    - 风险等级：无风险、轻度风险、中度风险、重度风险、极度风险
    - 显示格式：`{{ districtRisk.drought }}`
    - 分析依据：土壤墒情、降水预报、蒸发量、作物需水量
    - 灌溉建议：`{{ districtRisk.droughtSuggestion }}`
  
  - **产量预测:**
    - 预测值：`{{ districtRisk.yield }}`
    - 预测依据：当前长势、历史产量、气象条件、管理水平
    - 置信区间：±5%
    - 同比分析：较去年同期增减百分比
    - 增产建议：`{{ districtRisk.yieldSuggestion }}`
  
  - **市场风险:**
    - 价格趋势：上涨/下跌/平稳
    - 供需关系：供过于求/供不应求/供需平衡
    - 市场建议：`{{ districtRisk.marketSuggestion }}`

**组件C: 辖区历史指标趋势**
- **定位:** 提供数据追溯和趋势预测能力。
- **内容结构:**
  - **单图表设计:** 将NDVI和土壤湿度合并为一个双轴折线图
  - **时间维度:** 过去6个月，每月4个数据点（月初、月中、月末、下月初），共24个数据点
  - **预测功能:** 未来3个月预测值，用虚线表示
  - **图表配置:**
    - 左Y轴：NDVI指数 (0-1)，蓝色线条
    - 右Y轴：土壤湿度 (0-100%)，绿色线条
    - X轴：时间标签，格式 "2024-01-01"
    - 图例：NDVI指数、土壤湿度、预测值
    - 交互：鼠标悬停显示具体数值和时间
  - **趋势分析:** 
    - 显示当前趋势：上升/下降/平稳
    - 异常点标注：红色圆点标记异常值
    - 趋势预测：基于历史数据预测未来3个月走势

**交互效果要求:**
- **切换动画:** 从全辖区数据切换到地块专属数据时，使用淡入淡出效果，持续时间300ms
- **数据加载:** 切换地块时显示加载状态，使用骨架屏或loading动画
- **错误处理:** 数据加载失败时显示友好的错误提示，并提供重试按钮

**响应式设计:**
- **桌面端:** 右侧容器宽度20%，高度撑满屏幕，底部留20px间隙
- **平板端:** 右侧容器宽度25%，高度自适应
- **移动端:** 右侧容器变为底部弹出面板，高度60%
> 实施要点（已优化）
- 两侧列与其子项统一 `min-width:0; min-height:0;`，防止在缩放与窄屏下文本/图表挤爆。
- 面板内容区与图表高度采用 `clamp()` 响应式策略，字号使用 `clamp()`，缩放更平滑。
- 顶部指标卡片文字与间距已微调，保证在中小屏下仍保持观感与不溢出。

**数据来源规范:**
- **实时数据:** 通过WebSocket或定时轮询获取最新监测数据
- **历史数据:** 从数据库或缓存中获取历史趋势数据
- **预测数据:** 基于AI模型计算的风险预测和产量预估
- **图像数据:** 从监控设备或无人机获取的大田实时图像

---

### 3.2 数据资源中心

> (此模块需求保持 V2.0 不变)

---

### 3.3 智能分析决策

> **[页面目标]** 对每个分析场景进行深度设计，明确输入、处理逻辑和输出结果，使其成为可独立演示和开发的完整功能。

#### 3.3.1 墒情监测与旱情分析
- **[页面目标]** 直观展示全县旱情分布，并能对任意地块进行深度历史数据追溯。
- **[筛选器]** `时间范围选择器` (快捷选项：近7天/近30天), `乡镇多选下拉框`。
- **[核心可视化布局]** 顶部为筛选器，中部是GIS地图，底部为数据图表区。
- **[具体组件描述]**
  - **GIS地图:** 地块根据土壤相对湿度分为5级渲染：`过湿(>85%)`-深蓝, `适宜(60-85%)`-绿色, `轻旱(40-60%)`-黄色, `中旱(20-40%)`-橙色, `重旱(<20%)`-红色。地图右下角必须有此图例说明。
  - **数据图表:** 默认显示全县各乡镇的平均土壤湿度柱状图。点击地图上任一地块后，此区域切换为该地块的"近30天土壤湿度变化"折线图，并标注出最高/最低值。

#### 3.3.2 作物长势遥感监测
- **[页面目标]** 通过遥感NDVI数据评估作物长势，并提供地块间的横向对比分析能力。
- **[筛选器]** `时间点选择器` (展示不同日期的遥感影像数据), `乡镇`, `作物类型`。
- **[核心可视化布局]** 页面分为左右两栏。左侧为GIS地图，右侧为数据分析区。
- **[具体组件描述]**
  - **GIS地图:** 地块根据NDVI值分为4级渲染：`优(>0.8)`-深绿, `良(0.6-0.8)`-绿色, `中(0.4-0.6)`-黄绿, `差(<0.4)`-黄色。用户可以点击地图上的"对比"按钮，然后选择最多4个地块。
  - **数据分析区:** 标题为"长势对比分析"。每当在地图上选择一个地块，就在此区域动态添加一个卡片。卡片内包含地块名称和一个mini折线图，展示该地块近3个季度的NDVI均值变化。

#### 3.3.3 土地用途分析
- **[页面目标]** 清晰地可视化全县土地资源的利用现状，并支持历史追溯，为国土规划和耕地保护提供数据依据。
- **[筛选器]** `年份选择器` (如 2025, 2020, 2015), `乡镇`。
- **[核心可视化布局]** 页面分为左右两栏，左侧为GIS地图，右侧为统计图表。
- **[具体组件描述]**
  - **GIS地图:** 根据地块的 `use_type` 属性进行颜色渲染。图例需明确：`耕地`-绿色, `林地`-深绿, `草地`-浅绿, `建设用地`-灰色, `水域`-蓝色。
  - **右侧统计面板:**
    - **面板1: 土地利用结构:** 一个ECharts玫瑰图，展示当前筛选条件下，各类土地用途的面积占比。
    - **面板2: 耕地变化趋势:** 一个ECharts分组柱状图，标题为"耕地面积变化"，X轴为乡镇名称，Y轴为面积（亩），对比展示当前年份与所选对比年份（如2015年）的耕地面积。

#### 3.3.4 耕地退化分析
- **[页面目标]** 识别存在退化风险的耕地，分析退化成因，为土壤改良和可持续耕作提供精准指导。
- **[筛选器]** `分析模型下拉框` (选项: 土壤酸化, 养分流失, 土壤盐碱化), `年份`。
- **[核心可视化布局]** 以GIS地图为核心，辅以数据面板进行量化说明。
- **[具体组件描述]**
  - **GIS地图:** 根据后台计算出的"退化指数"（0-1范围），将耕地地块渲染为不同风险等级的颜色：`高风险(指数>0.7)`-红色, `中风险(0.4-0.7)`-橙色, `低风险(<0.4)`-黄色。
  - **右侧数据面板:**
    - **风险等级统计:** 3个指标卡片，分别显示高、中、低风险的耕地面积及占比。
    - **退化趋势图:** 一个折线图，展示全县近10年的平均"退化指数"变化趋势。
    - **高风险地块列表:** 一个可滚动的列表，展示风险最高的10个地块的ID、所属乡镇和退化指数得分，点击可定位到地图上的对应位置。

#### 3.3.5 病虫害分析与预测
- **[页面目标]** 实时监控病虫害动态，预测扩散趋势，实现从被动响应到主动预警的转变。
- **[筛选器]** `时间范围`, `病虫害类型` (下拉多选: 稻飞虱, 玉米螟, 纹枯病等), `预警等级`。
- **[核心可视化布局]** 动态、时空一体化布局。中间为GIS地图，底部为时间轴，右侧为信息面板。
- **[具体组件描述]**
  - **GIS地图:** 地图上叠加两种图层：1. 已上报的病虫害"事件点"，用不同图标表示。 2. 基于算法预测的"风险圈"，为半透明的渐变色区域，表示未来24/48小时可能的扩散范围。
  - **时间轴:** 一个可拖动的滑块，范围是筛选器选定的时间。拖动滑块，地图上的"事件点"和"风险圈"会随时间动态变化，形成一个时空演变动画。
  - **右侧信息面板:**
    - **当前态势:** 统计`当前主要病害`, `累计影响面积`, `已发布预警数`。
    - **病害发生频率:** 一个条形图，统计所选时间内，不同病虫害的发生次数，进行排序。

#### 3.3.6 产量与产值预测
- **[页面目标]** 整合多源数据，提供对未来产量的科学预测，为农业生产和市场规划提供决策支持。
- **[筛选器]** `年份`, `季度`, `作物类型`。
- **[核心可视化布局]** 类仪表盘布局，顶部为核心预测总览，下方为多维度图表。
- **[具体组件描述]**
  - **核心预测卡片:** 4个大数字卡片，展示 `预估总产量(吨)`, `同比增减(%)`, `预估总产值(万元)`, `环比增减(%)`。
  - **产量分布柱状图:** 按乡镇展示各乡镇的预估产量，并可与去年同期数据进行对比。
  - **预测修正历史:** 一个折线图，展示自播种以来，模型对最终产量的预测值的变化过程，体现模型的动态调整能力。
  - **详细数据表格:** 列出各乡镇的 `种植面积`, `预估亩产(公斤)`, `市场均价(元/公斤)` 等详细数据。

#### 3.3.7 智慧灌溉数字孪生
- **[页面目标]** 以高保真三维场景，全过程模拟和展示一个高标准农田的自动化、智能化灌溉作业，是平台技术实力的终极体现。
- **[筛选器]** 页面加载一个预设的"高标准农田示范区"，无全局筛选器。
- **[核心可视化布局]** 全屏沉浸式3D场景，数据和控制面板以HUD（平视显示器）风格叠加在场景上。
- **[具体组件描述]**
  - **3D场景:** 使用Three.js或类似库构建。包含：地块的微地形、成排的作物三维模型、土壤传感器模型、气象站模型、以及可见的喷灌或滴灌管道和阀门。
  - **HUD面板1: 环境与土壤监测 (左上角)**
    - **环境:** `空气温度`, `空气湿度`, `风速`, `光照强度` 的实时仪表盘。
    - **土壤:** 以网格形式展示该地块内9个分区的土壤湿度实时读数，直观体现土壤墒情的不均匀性。
  - **HUD面板2: 灌溉控制与策略 (右侧)**
    - **模式选择:** `智能决策模式`(算法自动执行), `定时定量模式`, `手动控制模式`。
    - **策略选择 (智能模式下):** `节水优先策略`, `增产优先策略`。
    - **手动控制:** 开关组，可手动控制9个分区的阀门。
    - **执行按钮:** `启动灌溉任务`。
  - **HUD面板3: 成本与能耗分析 (左下角)**
    - 实时累计 `本次用水量(吨)`, `预估水费(元)`, `预估电费(元)`。
  - **动画效果:** 启动灌溉后，3D场景中对应的喷头或管道出现逼真的水流粒子特效，同时HUD面板上的土壤湿度读数和成本数据同步动态增长。

---

### 3.4 农户管理

> **[页面目标]** 建立一个集中的农业主体资源管理中心，对农户档案、关联土地、自有农机和农资使用进行全生命周期管理。

#### 3.4.1 主页面：农户列表
- **布局:** 占据整个页面的数据面板。
- **功能区:**
  - **搜索框:** 支持按 `姓名` 或 `联系电话` 模糊搜索。
  - **筛选器:** 按 `所属乡镇` 进行下拉筛选。
  - **操作按钮:** "新增农户" 按钮，样式醒目。
- **表格字段:** `农户ID`, `姓名`, `联系电话`, `所属乡镇`, `地块数量`, `农机数量`, `最后更新时间`, `操作`(`查看详情`, `编辑`, `删除`)。

#### 3.4.2 新增/编辑农户
- **交互:** 点击 "新增农户" 或 "编辑" 按钮，弹出一个 `el-dialog` 模态框。
- **表单字段:** `姓名`, `联系电话`, `身份证号`, `所属乡镇`(下拉), `家庭住址`, `备注`(文本域)。

#### 3.4.3 农户详情页 (`/farmer-management/:id`)
- **页面目标:** 360度全景展示与该农户相关的所有农业资源。
- **布局:** 顶部为该农户的"名片"（姓名、电话、乡镇），下方为一个 `el-tabs` 标签页组件。
- **标签页 (Tabs):**
  - **Tab 1: 关联地块:**
    - **功能:** 一个数据表格，显示该农户拥有的所有地块。
    - **表格字段:** `地块ID`, `地块名称`, `作物`, `面积(亩)`, `地力指数`。
    - **操作:** 提供"关联新地块"按钮，可打开一个包含全县未分配地块列表的模态框供选择。
  - **Tab 2: 农机管理:**
    - **功能:** 管理该农户拥有的所有农业机械。
    - **表格字段:** `农机ID`, `类型`(拖拉机/收割机/无人机), `品牌型号`, `购买日期`, `状态`(正常/维修中/报废), `最后作业时间`。
    - **操作:** 提供"新增农机"按钮。
  - **Tab 3: 农资使用记录:**
    - **功能:** 记录该农户的农药、化肥等农资的采购和使用情况。
    - **表格字段:** `使用日期`, `农资类型`, `品牌规格`, `用量`, `使用地块`, `操作员`。
  - **Tab 4: 收益分析:**
    - **功能:** 展示该农户的年度收益情况和成本分析。
    - **内容:** 包含收入构成饼图、月度收支对比柱状图等可视化组件。

---

### 3.5 系统管理

> **[页面目标]** 提供平台的基础配置管理功能，确保系统的稳定运行和数据安全。

#### 3.5.1 用户管理
- **功能:** 管理平台用户账户，包括用户的创建、编辑、禁用等操作。
- **权限控制:** 不同用户角色（管理员、分析员、操作员）具有不同的功能访问权限。
- **表格字段:** `用户ID`, `用户名`, `真实姓名`, `角色`, `所属部门`, `最后登录时间`, `状态`, `操作`。

#### 3.5.2 数据源管理
- **功能:** 配置和管理各类数据源的接入参数。
- **支持的数据源类型:** 
  - 气象数据API
  - 遥感影像服务
  - 物联网设备数据
  - 第三方农业数据平台
- **配置项:** `数据源名称`, `类型`, `接入地址`, `认证信息`, `更新频率`, `状态`。

#### 3.5.3 系统日志
- **功能:** 记录系统的运行日志和用户操作日志，便于问题排查和安全审计。
- **日志类型:**
  - 登录日志
  - 操作日志  
  - 错误日志
  - 系统运行日志
- **查询功能:** 支持按时间范围、用户、操作类型等条件进行日志查询和导出。

#### 3.5.4 系统配置
- **功能:** 管理系统的基础配置参数。
- **配置项:**
  - 系统基础信息（系统名称、版本信息等）
  - 地图配置（默认中心点、缩放级别等）
  - 预警阈值配置
  - 数据更新频率设置
  - 消息通知配置

---

## 4. 技术实现要点

### 4.1 前端架构
- **推荐框架:** Vue 3 + Element Plus 或 React + Ant Design
- **状态管理:** Vuex/Pinia 或 Redux Toolkit
- **路由管理:** Vue Router 或 React Router
- **图表库:** ECharts 5.x
- **地图库:** MapLibre GL JS 或 Leaflet
- **3D渲染:** Three.js（智慧灌溉模块）

### 4.2 数据结构设计
- **地块数据:** GeoJSON格式，包含几何信息和属性信息
- **设备数据:** JSON格式，包含位置、状态、类型等信息
- **历史数据:** 时间序列数据，支持按时间范围查询
- **用户数据:** 包含用户基础信息、权限配置等

### 4.3 性能优化策略
- **数据懒加载:** 大数据集按需加载，避免首屏阻塞
- **图片优化:** 使用WebP格式，实现响应式图片
- **缓存策略:** 静态资源缓存，API数据缓存
- **虚拟滚动:** 长列表使用虚拟滚动技术
- **代码分割:** 按路由和功能模块进行代码分割

### 4.4 兼容性要求
- **浏览器支持:** Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **分辨率支持:** 1920x1080 及以上分辨率优化显示
- **移动端适配:** 响应式设计，支持平板设备访问

---

## 5. 项目交付物

### 5.1 代码交付
- **源代码:** 完整的前端项目源代码
- **构建脚本:** 包含开发、测试、生产环境的构建配置
- **依赖清单:** package.json 及锁定文件
- **环境配置:** 开发和部署环境的配置文件

### 5.2 文档交付
- **技术文档:** 系统架构、API接口、部署指南
- **用户手册:** 功能操作说明和最佳实践
- **维护文档:** 常见问题解决方案和维护指南

### 5.3 测试交付
- **单元测试:** 核心业务逻辑的单元测试用例
- **集成测试:** 主要功能流程的集成测试
- **性能测试报告:** 系统性能指标和优化建议

---

## 6. 项目里程碑

### Phase 1: 基础框架搭建 (1-2周)
- 项目框架初始化
- 基础UI组件库集成
- 路由和状态管理配置
- 顶部导航栏实现

### Phase 2: 核心功能开发 (3-5周)
- 综合态势大屏开发
- GIS地图集成和基础功能
- 数据可视化组件开发
- 基础数据模拟和接口

### Phase 3: 分析功能开发 (2-3周)
- 智能分析各子模块开发
- 高级图表和交互功能
- 3D场景开发（智慧灌溉）
- 数据联动和状态同步

### Phase 4: 管理功能开发 (1-2周)
- 农户管理模块
- 系统管理功能
- 用户权限和安全
- 数据导入导出

### Phase 5: 测试优化 (1-2周)
- 功能测试和bug修复
- 性能优化和兼容性测试
- UI/UX优化和视觉效果调整
- 文档编写和项目交付

---

## 7. 风险评估与应对

### 7.1 技术风险
- **风险:** 3D场景渲染性能问题
- **应对:** 提前进行性能测试，准备降级方案

### 7.2 数据风险  
- **风险:** 模拟数据不够真实
- **应对:** 基于真实场景设计数据结构，确保演示效果

### 7.3 兼容性风险
- **风险:** 不同浏览器表现不一致
- **应对:** 制定明确的兼容性标准，进行充分测试

### 7.4 项目进度风险
- **风险:** 功能复杂度超出预期
- **应对:** 采用敏捷开发模式，优先实现核心功能

---

*文档版本: V2.1 - 重构版*  
*最后更新: 2025-08-29*  
*更新内容: 综合态势大屏深度重构，新增组件化设计思路*